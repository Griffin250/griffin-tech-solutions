<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>0x244 Functions</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part24.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part26.htm">Next &gt;</a></p><p class="s32" style="padding-top: 4pt;padding-left: 91pt;text-indent: 0pt;text-align: left;"><a name="bookmark15">0x244 Functions</a></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">Sometimes there will be a set of instructions the programmer knows he will need several times. These instructions can be grouped into a smaller sub- program called a <span class="s27">function</span>. In other languages, functions are known as sub- routines or procedures. For example, the action of turning a car actually consists of many smaller instructions: Turn on the appropriate blinker, slow down, check for oncoming traffic, turn the steering wheel in the appropriate direction, and so on. The driving directions from the beginning of this chap- ter require quite a few turns; however, listing every little instruction for every turn would be tedious (and less readable). You can pass variables as arguments to a function in order to modify the way the function operates. In this case, the function is passed the direction of the turn.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_054.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Function Turn(variable_direction)</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Activate the variable_direction blinker; Slow down;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Check for oncoming traffic; while(there is oncoming traffic)</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{</p><p class="s31" style="padding-left: 108pt;text-indent: 0pt;text-align: left;">Stop;</p><p class="s31" style="padding-left: 108pt;text-indent: 0pt;text-align: left;">Watch for oncoming traffic;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Turn the steering wheel to the variable_direction; while(turn is not complete)</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 116pt;text-indent: -8pt;text-align: left;">if(speed &lt; 5 mph) Accelerate;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Turn the steering wheel back to the original position; Turn off the variable_direction blinker;</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">}</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_055.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">This function describes all the instructions needed to make a turn. When a program that knows about this function needs to turn, it can just call this function. When the function is called, the instructions found within it are executed with the arguments passed to it; afterward, execution returns to where it was in the program, after the function call. Either left or right can be passed into this function, which causes the function to turn in that</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 11pt;text-align: left;">direction.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">By default in C, functions can return a value to a caller. For those familiar with functions in mathematics, this makes perfect sense. Imagine a function that calculates the factorial of a number—naturally, it returns the result.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">In C, functions aren’t labeled with a “function” keyword; instead, they are declared by the data type of the variable they are returning. This format looks very similar to variable declaration. If a function is meant to return an</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">integer (perhaps a function that calculates the factorial of some number <span class="s27">x</span>), the function could look like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_056.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">int factorial(int x)</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">int i;</p><p class="s31" style="padding-left: 108pt;text-indent: -8pt;text-align: left;">for(i=1; i &lt; x; i++) x *= i;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">return x;</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_057.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;text-align: left;">This function is declared as an integer because it multiplies every value from 1 to <span class="s27">x </span>and returns the result, which is an integer. The return statement at the end of the function passes back the contents of the variable <span class="s27">x </span>and ends the function. This factorial function can then be used like an integer variable in the main part of any program that knows about it.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_058.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">int a=5, b;</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b = factorial(a);</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_059.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">At the end of this short program, the variable <span class="s31">b </span>will contain 120, since the factorial function will be called with the argument of 5 and will return 120.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 107%;text-align: left;">Also in C, the compiler must “know” about functions before it can use them. This can be done by simply writing the entire function before using it later in the program or by using function prototypes. A <span class="s27">function prototype </span>is simply a way to tell the compiler to expect a function with this name, this return data type, and these data types as its functional arguments. The actual function can be located near the end of the program, but it can be used any- where else, since the compiler already knows about it. An example of a func- tion prototype for the <span class="s31">factorial() </span>function would look something like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_060.png"/></span></p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">int factorial(int);</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_061.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: justify;">Usually, function prototypes are located near the beginning of a program. There’s no need to actually define any variable names in the prototype, since this is done in the actual function. The only thing the compiler cares about is the function’s name, its return data type, and the data types of its functional arguments.</p><p style="padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">If a function doesn’t have any value to return, it should be declared as <span class="s31">void</span>, as is the case with the <span class="s31">turn() </span>function I used as an example earlier. However, the <span class="s31">turn() </span>function doesn’t yet capture all the functionality that our driving directions need. Every turn in the directions has both a direction and a street name. This means that a turning function should have two variables: the direction to turn and the street to turn on to. This complicates the function of turning, since the proper street must be located before the turn can be made. A more complete turning function using proper C-like syntax is listed below in pseudo-code.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_062.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">void turn(variable_direction, target_street_name)</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">Look for a street sign;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">current_intersection_name = read street sign name; while(current_intersection_name != target_street_name)</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 108pt;text-indent: 0pt;line-height: 107%;text-align: left;">Look for another street sign; current_intersection_name = read street sign name;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 10pt;text-align: left;">}</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-top: 4pt;padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Activate the variable_direction blinker; Slow down;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Check for oncoming traffic; while(there is oncoming traffic)</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 108pt;text-indent: 0pt;text-align: left;">Stop;</p><p class="s31" style="padding-left: 108pt;text-indent: 0pt;text-align: left;">Watch for oncoming traffic;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Turn the steering wheel to the variable_direction; while(turn is not complete)</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 10pt;text-align: left;">{</p><p class="s31" style="padding-left: 116pt;text-indent: -8pt;line-height: 107%;text-align: left;">if(speed &lt; 5 mph) Accelerate;</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 107%;text-align: left;">Turn the steering wheel right back to the original position; Turn off the variable_direction blinker;</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">}</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_063.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">This function includes a section that searches for the proper intersection by looking for street signs, reading the name on each street sign, and storing that name in a variable called <span class="s31">current_intersection_name</span>. It will continue to look for and read street signs until the target street is found; at that point, the remaining turning instructions will be executed. The pseudo-code driving instructions can now be changed to use this turning function.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_064.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Begin going East on Main Street;</p><p class="s31" style="padding-left: 104pt;text-indent: -12pt;line-height: 107%;text-align: left;">while (there is not a church on the right) Drive down Main Street;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">if (street is blocked)</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">{</p><p class="s31" style="padding-left: 99pt;text-indent: 0pt;line-height: 106%;text-align: left;">Turn(right, 15th Street); Turn(left, Pine Street); Turn(right, 16th Street);</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">}</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">else</p><p class="s31" style="padding-left: 91pt;text-indent: 8pt;line-height: 106%;text-align: left;">Turn(right, 16th Street); Turn(left, Destination Road); for (i=0; i&lt;5; i++)</p><p class="s31" style="padding-bottom: 2pt;padding-left: 91pt;text-indent: 8pt;line-height: 107%;text-align: left;">Drive straight for 1 mile; Stop at 743 Destination Road;</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_065.png"/></span></p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 17pt;line-height: 106%;text-align: left;">Functions aren’t commonly used in pseudo-code, since pseudo-code is mostly used as a way for programmers to sketch out program concepts before writing compilable code. Since pseudo-code doesn’t actually have to work, full functions don’t need to be written out—simply jotting down <span class="s27">Do some complex stuff here </span>will suffice. But in a programming language like C, functions are used heavily. Most of the real usefulness of C comes from collections of existing functions called <span class="s27">libraries</span>.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part26.htm">0x250 Getting Your Hands Dirty</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part24.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part26.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
