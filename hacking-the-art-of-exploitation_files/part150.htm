<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>0x682 How to Hide a Sled</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part149.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part151.htm">Next &gt;</a></p><p class="s32" style="padding-left: 91pt;text-indent: 0pt;text-align: left;"><a name="bookmark137">0x682 How to Hide a Sled</a></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">The NOP sled is another signature easy to detect by network IDSes and IPSes. Large blocks of <span class="s31">0x90 </span>aren’t that common, so if a network security mechanism sees something like this, it’s probably an exploit. To avoid this signature, we can use different single-byte instructions instead of NOP. There are several one-byte instructions—the increment and decrement instructions for various registers—that are also printable ASCII characters.</p><table style="border-collapse:collapse;margin-left:91.44pt" cellspacing="0"><tr style="height:13pt"><td style="width:44pt;border-top-style:solid;border-top-width:5pt;border-bottom-style:solid;border-bottom-width:2pt"><p class="s34" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Instruction</p></td><td style="width:30pt;border-top-style:solid;border-top-width:5pt;border-bottom-style:solid;border-bottom-width:2pt"><p class="s34" style="padding-left: 6pt;text-indent: 0pt;line-height: 10pt;text-align: left;">Hex</p></td><td style="width:37pt;border-top-style:solid;border-top-width:5pt;border-bottom-style:solid;border-bottom-width:2pt"><p class="s34" style="padding-left: 8pt;text-indent: 0pt;line-height: 10pt;text-align: left;">ASCII</p></td></tr><tr style="height:12pt"><td style="width:44pt;border-top-style:solid;border-top-width:2pt"><p class="s68" style="padding-left: 2pt;text-indent: 0pt;text-align: left;">inc eax</p></td><td style="width:30pt;border-top-style:solid;border-top-width:2pt"><p class="s36" style="padding-left: 6pt;text-indent: 0pt;text-align: left;">0x40</p></td><td style="width:37pt;border-top-style:solid;border-top-width:2pt"><p class="s68" style="padding-left: 8pt;text-indent: 0pt;text-align: left;">@</p></td></tr><tr style="height:14pt"><td style="width:44pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">inc ebx</p></td><td style="width:30pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x43</p></td><td style="width:37pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">C</p></td></tr><tr style="height:14pt"><td style="width:44pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">inc ecx</p></td><td style="width:30pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x41</p></td><td style="width:37pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">A</p></td></tr><tr style="height:14pt"><td style="width:44pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">inc edx</p></td><td style="width:30pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x42</p></td><td style="width:37pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">B</p></td></tr><tr style="height:14pt"><td style="width:44pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">dec eax</p></td><td style="width:30pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x48</p></td><td style="width:37pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">H</p></td></tr><tr style="height:14pt"><td style="width:44pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">dec ebx</p></td><td style="width:30pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x4B</p></td><td style="width:37pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">K</p></td></tr><tr style="height:14pt"><td style="width:44pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">dec ecx</p></td><td style="width:30pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x49</p></td><td style="width:37pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">I</p></td></tr><tr style="height:14pt"><td style="width:44pt;border-bottom-style:solid;border-bottom-width:2pt"><p class="s68" style="padding-top: 2pt;padding-left: 2pt;text-indent: 0pt;text-align: left;">dec edx</p></td><td style="width:30pt;border-bottom-style:solid;border-bottom-width:2pt"><p class="s36" style="padding-top: 2pt;padding-left: 6pt;text-indent: 0pt;text-align: left;">0x4A</p></td><td style="width:37pt;border-bottom-style:solid;border-bottom-width:2pt"><p class="s68" style="padding-top: 2pt;padding-left: 8pt;text-indent: 0pt;text-align: left;">J</p></td></tr></table><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Since we zero out these registers before we use them, we can safely use a random combination of these bytes for the NOP sled. Creating a new exploit tool that uses random combinations of the bytes <span class="s31">@</span>, <span class="s31">C</span>, <span class="s31">A</span>, <span class="s31">B</span>, <span class="s31">H</span>, <span class="s31">K</span>, <span class="s31">I</span>, and <span class="s31">J </span>instead of a regular NOP sled will be left as an exercise for the reader. The easiest way to do this would be by writing a sled-generation program in C, which is used with a BASH script. This modification will hide the exploit buffer from IDSes that look for a NOP sled.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part151.htm">0x690 Buffer Restrictions</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part149.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part151.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
