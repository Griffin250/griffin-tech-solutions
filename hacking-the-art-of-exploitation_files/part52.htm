<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>Program exploitation is a staple of hacking. As demon- strated in the previous chapter, a program is made up of a complex set of rules following a certain execution flow that ultimately tells the computer what to do.</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part51.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part53.htm">Next &gt;</a></p><p class="s26" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Program exploitation is a staple of hacking. As demon- strated in the previous chapter, a program is made up of a complex set of rules following a certain execution flow that ultimately tells the computer what to do.</p><p class="s26" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">Exploiting a program is simply a clever way of getting the computer to do what you want it to do, even if the</p><p style="padding-top: 1pt;padding-left: 91pt;text-indent: 0pt;line-height: 112%;text-align: left;">currently running program was designed to prevent that action. Since a program can really only do what it’s designed to do, the security holes are actually flaws or oversights in the design of the program or the environment the program is running in. It takes a creative mind to find these holes and to write programs that compensate for them. Sometimes these holes are the products of relatively obvious programmer errors, but there are some less obvious errors that have given birth to more complex exploit techniques that can be applied in many different places.</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: justify;">A program can only do what it’s programmed to do, to the letter of the law. Unfortunately, what’s written doesn’t always coincide with what the program- mer intended the program to do. This principle can be explained with a joke:</p><p class="s28" style="padding-top: 5pt;padding-left: 127pt;text-indent: 0pt;line-height: 110%;text-align: justify;">A man is walking through the woods, and he finds a magic lamp on the ground. Instinctively, he picks the lamp up, rubs the side of it with his sleeve, and out pops a genie. The genie thanks the man for freeing him, and offers to grant him three wishes. The man is ecstatic and knows exactly what he wants.</p><p class="s28" style="padding-top: 5pt;padding-left: 127pt;text-indent: 0pt;text-align: justify;">“First,” says the man, “I want a billion dollars.”</p><p class="s28" style="padding-top: 5pt;padding-left: 127pt;text-indent: 0pt;line-height: 111%;text-align: left;">The genie snaps his fingers and a briefcase full of money materializes out of thin air.</p><p class="s28" style="padding-top: 4pt;padding-left: 127pt;text-indent: 0pt;line-height: 111%;text-align: left;">The man is wide eyed in amazement and continues, “Next, I want a Ferrari.”</p><p class="s28" style="padding-top: 4pt;padding-left: 127pt;text-indent: 0pt;line-height: 111%;text-align: left;">The genie snaps his fingers and a Ferrari appears from a puff of smoke.</p><p class="s28" style="padding-top: 4pt;padding-left: 127pt;text-indent: 0pt;text-align: left;">The man continues, “Finally, I want to be irresistible to women.”</p><p class="s28" style="padding-top: 6pt;padding-left: 127pt;text-indent: 0pt;line-height: 108%;text-align: left;">The genie snaps his fingers and the man turns into a box of chocolates.</p><p style="padding-top: 5pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Just as the man’s final wish was granted based on what he said, rather than what he was thinking, a program will follow its instructions exactly, and the results aren’t always what the programmer intended. Sometimes the repercussions can be catastrophic.</p><p style="padding-left: 91pt;text-indent: 18pt;line-height: 107%;text-align: left;">Programmers are human, and sometimes what they write isn’t exactly what they mean. For example, one common programming error is called an <span class="s27">off-by-one </span>error. As the name implies, it’s an error where the programmer has miscounted by one. This happens more often than you might think, and it is best illustrated with a question: If you’re building a 100-foot fence, with fence posts spaced 10 feet apart, how many fence posts do you need? The obvious answer is 10 fence posts, but this is incorrect, since you actually need 11. This type of off-by-one error is commonly called a <span class="s27">fencepost error</span>, and it occurs when a programmer mistakenly counts items instead of spaces between items, or vice versa. Another example is when a programmer is trying to select a range of numbers or items for processing, such as items <span class="s33">N </span>through <span class="s33">M</span>. If <span class="s31">N = 5 </span>and <span class="s31">M = 17</span>, how many items are there to process? The obvious answer is <span class="s31">M - N</span>, or <span class="s31">17 - 5 = 12 </span>items. But this is incorrect, since there are actually <span class="s31">M - N + 1 </span>items, for a total of <span class="s31">13 </span>items. This may seem counterintuitive at first glance, because it is, and that’s exactly why these errors happen.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Often, fencepost errors go unnoticed because programs aren’t tested for every single possibility, and the effects of a fencepost error don’t generally occur during normal program execution. However, when the program is fed the input that makes the effects of the error manifest, the consequences of the error can have an avalanche effect on the rest of the program logic. When properly exploited, an off-by-one error can cause a seemingly secure program to become a security vulnerability.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">One classic example of this is OpenSSH, which is meant to be a secure terminal communication program suite, designed to replace insecure and</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: justify;">unencrypted services such as telnet, rsh, and rcp. However, there was an off- by-one error in the channel-allocation code that was heavily exploited. Specific- ally, the code included an if statement that read:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_325.png"/></span></p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: justify;">if (id &lt; 0 || id &gt; channels_alloc) {</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_326.png"/></span></p><p style="padding-top: 7pt;padding-left: 109pt;text-indent: 0pt;text-align: left;">It should have been</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_327.png"/></span></p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: justify;">if (id &lt; 0 || id &gt;= channels_alloc) {</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_328.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;text-align: left;">In plain English, the code reads <span class="s27">If the ID is less than 0 or the ID is greater than the channels allocated, do the following stuff</span>, when it should have been <span class="s27">If the ID is less than 0 or the ID is greater than </span>or equal to <span class="s27">the channels allocated, do the following stuff</span>.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">This simple off-by-one error allowed further exploitation of the pro- gram, so that a normal user authenticating and logging in could gain full administrative rights to the system. This type of functionality certainly wasn’t what the programmers had intended for a secure program like OpenSSH, but a computer can only do what it’s told.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Another situation that seems to breed exploitable programmer errors is when a program is quickly modified to expand its functionality. While this increase in functionality makes the program more marketable and increases its value, it also increases the program’s complexity, which increases the chances of an oversight. Microsoft’s IIS webserver program is designed to serve static and interactive web content to users. In order to accomplish this, the program must allow users to read, write, and execute programs and files within certain directories; however, this functionality must be limited to those particular directories. Without this limitation, users would have full control of the system, which is obviously undesirable from a security perspective. To prevent this situation, the program has path-checking code designed to prevent users from using the backslash character to traverse backward through the directory tree and enter other directories.</p><p style="padding-left: 109pt;text-indent: 0pt;line-height: 11pt;text-align: left;">With the addition of support for the Unicode character set, though, the</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">complexity of the program continued to increase. <span class="s27">Unicode </span>is a double-byte character set designed to provide characters for every language, including Chinese and Arabic. By using two bytes for each character instead of just one, Unicode allows for tens of thousands of possible characters, as opposed to the few hundred allowed by single-byte characters. This additional complexity means that there are now multiple representations of the backslash charac- ter. For example, <span class="s31">%5c </span>in Unicode translates to the backslash character, but this translation was done <span class="s27">after </span>the path-checking code had run. So by using</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">%5c <span class="p">instead of </span>\<span class="p">, it was indeed possible to traverse directories, allowing the aforementioned security dangers. Both the Sadmind worm and the CodeRed worm used this type of Unicode conversion oversight to deface web pages.</span></p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">A related example of this letter-of-the-law principle used outside the realm of computer programming is the LaMacchia Loophole. Just like the rules of a computer program, the US legal system sometimes has rules that</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">don’t say exactly what their creators intended, and like a computer program exploit, these legal loopholes can be used to sidestep the intent of the law. Near the end of 1993, a 21-year-old computer hacker and student at MIT named David LaMacchia set up a bulletin board system called Cynosure for the purposes of software piracy. Those who had software to give would upload it, and those who wanted software would download it. The service was only online for about six weeks, but it generated heavy network traffic worldwide, which eventually attracted the attention of university and federal authorities. Software companies claimed that they lost one million dollars as a result of Cynosure, and a federal grand jury charged LaMacchia with one count of conspiring with unknown persons to violate the wire fraud statue. However, the charge was dismissed because what LaMacchia was alleged to have done wasn’t criminal conduct under the Copyright Act, since the infringement was not for the purpose of commercial advantage or private financial gain. Apparently, the lawmakers had never anticipated that someone might engage in these types of activities with a motive other than personal financial gain. (Congress closed this loophole in 1997 with the No Electronic Theft Act.) Even though this example doesn’t involve the exploiting of a computer program, the judges and courts can be thought of as computers executing the program of the legal system as it was written. The abstract concepts of</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 10pt;text-align: left;">hacking transcend computing and can be applied to many other aspects</p><p style="padding-left: 91pt;text-indent: 0pt;text-align: left;">of life that involve complex systems.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="toc">&nbsp;</p><div class="toc"><a class="toc0" href="part53.htm">0x310 Generalized Exploit Techniques</a><a class="toc0" href="part54.htm">0x320 Buffer Overflows</a><a class="toc0" href="part55.htm">0x321  Stack-Based Buffer Overflow Vulnerabilities</a><a class="toc1" href="part56.htm">0x330 Experimenting with BASH</a><a class="toc0" href="part57.htm">0x331 Using the Environment</a><a class="toc1" href="part58.htm">0x340 Overflows in Other Segments</a><a class="toc0" href="part59.htm">0x341  A Basic Heap-Based Overflow</a><a class="toc0" href="part60.htm">0x342 Overflowing Function Pointers</a><a class="toc1" href="part61.htm">0x350 Format Strings</a><a class="toc0" href="part62.htm">0x351 Format Parameters</a><a class="toc0" href="part63.htm">0x352 The Format String Vulnerability</a><a class="toc0" href="part64.htm">0x353  Reading from Arbitrary Memory Addresses</a><a class="toc0" href="part65.htm">0x354 Writing to Arbitrary Memory Addresses</a><a class="toc0" href="part66.htm">0x355 Direct Parameter Access</a><a class="toc0" href="part67.htm">0x356 Using Short Writes</a><a class="toc0" href="part68.htm">0x357 Detours with .dtors</a><a class="toc0" href="part69.htm">0x358 Another notesearch Vulnerability</a><a class="toc0" href="part70.htm">0x359  Overwriting the Global Offset Table</a></div><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part51.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part53.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
